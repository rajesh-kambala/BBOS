<?xml version="1.0" encoding="utf-8"?>
<Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2008/01/reportdefinition" xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner">
  <Body>
    <ReportItems>
      <Tablix Name="listMonitoredCompany">
        <TablixBody>
          <TablixColumns>
            <TablixColumn>
              <Width>7.525in</Width>
            </TablixColumn>
          </TablixColumns>
          <TablixRows>
            <TablixRow>
              <Height>1.125in</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <Rectangle Name="listMonitoredCompany_Contents">
                      <ReportItems>
                        <Textbox Name="ListingLocation">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!CityStateCountryShort.Value</Value>
                                  <Style />
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <Left>0.025in</Left>
                          <Height>0.25in</Height>
                          <Width>7.5in</Width>
                          <Style>
                            <Border>
                              <Style>None</Style>
                            </Border>
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                        <Textbox Name="BBID">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=CStr(Fields!MonitoredCompanyID.Value)</Value>
                                  <Style />
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <Top>0.25in</Top>
                          <Left>0.025in</Left>
                          <Height>0.25in</Height>
                          <Width>7.5in</Width>
                          <ZIndex>1</ZIndex>
                          <Style>
                            <Border>
                              <Style>None</Style>
                            </Border>
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                        <Textbox Name="CompanyName">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!comp_PRCorrTradestyle.Value</Value>
                                  <Style />
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <Top>0.5in</Top>
                          <Left>0.025in</Left>
                          <Height>0.25in</Height>
                          <Width>7.5in</Width>
                          <ZIndex>2</ZIndex>
                          <Style>
                            <Border>
                              <Style>None</Style>
                            </Border>
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                        <Subreport Name="subreport1">
                          <ReportName>AUS Tabular Details</ReportName>
                          <Parameters>
                            <Parameter Name="CompanyID">
                              <Value>=Fields!MonitoredCompanyID.Value</Value>
                            </Parameter>
                            <Parameter Name="StartDate">
                              <Value>=Parameters!StartDate.Value</Value>
                            </Parameter>
                            <Parameter Name="EndDate">
                              <Value>=Parameters!EndDate.Value</Value>
                            </Parameter>
                            <Parameter Name="ChangePreference">
                              <Value>=First(Fields!peli_PRAUSChangePreference.Value, "dsHeader")</Value>
                            </Parameter>
                          </Parameters>
                          <KeepTogether>true</KeepTogether>
                          <Top>0.81944in</Top>
                          <Left>0.025in</Left>
                          <Height>0.19792in</Height>
                          <Width>7.5in</Width>
                          <ZIndex>3</ZIndex>
                          <Style>
                            <Border>
                              <Style>None</Style>
                            </Border>
                          </Style>
                        </Subreport>
                      </ReportItems>
                      <KeepTogether>true</KeepTogether>
                      <Style />
                    </Rectangle>
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
          </TablixRows>
        </TablixBody>
        <TablixColumnHierarchy>
          <TablixMembers>
            <TablixMember />
          </TablixMembers>
        </TablixColumnHierarchy>
        <TablixRowHierarchy>
          <TablixMembers>
            <TablixMember>
              <Group Name="listMonitoredCompany_Details_Group">
                <DataElementName>Item</DataElementName>
              </Group>
              <DataElementName>Item_Collection</DataElementName>
              <DataElementOutput>Output</DataElementOutput>
              <KeepTogether>true</KeepTogether>
            </TablixMember>
          </TablixMembers>
        </TablixRowHierarchy>
        <DataSetName>dsMonitoredCompany</DataSetName>
        <Top>0.84375in</Top>
        <Height>1.125in</Height>
        <Width>7.525in</Width>
        <Style />
      </Tablix>
      <Textbox Name="Date">
        <CanGrow>true</CanGrow>
        <CanShrink>true</CanShrink>
        <KeepTogether>true</KeepTogether>
        <Paragraphs>
          <Paragraph>
            <TextRuns>
              <TextRun>
                <Value>=FormatDateTime(Parameters!EndDate.Value, DateFormat.ShortDate )</Value>
                <Style>
                  <FontSize>12pt</FontSize>
                </Style>
              </TextRun>
            </TextRuns>
            <Style>
              <TextAlign>Center</TextAlign>
            </Style>
          </Paragraph>
        </Paragraphs>
        <Top>0.01389in</Top>
        <Height>0.23438in</Height>
        <Width>7.5875in</Width>
        <ZIndex>1</ZIndex>
        <Style>
          <Border>
            <Style>None</Style>
          </Border>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
        </Style>
      </Textbox>
      <Textbox Name="Person">
        <CanGrow>true</CanGrow>
        <CanShrink>true</CanShrink>
        <KeepTogether>true</KeepTogether>
        <Paragraphs>
          <Paragraph>
            <TextRuns>
              <TextRun>
                <Value>=First(Fields!FullName.Value, "dsHeader")</Value>
                <Style>
                  <FontSize>12pt</FontSize>
                </Style>
              </TextRun>
            </TextRuns>
            <Style>
              <TextAlign>Center</TextAlign>
            </Style>
          </Paragraph>
        </Paragraphs>
        <Top>0.24826in</Top>
        <Height>0.2066in</Height>
        <Width>7.5875in</Width>
        <ZIndex>2</ZIndex>
        <Style>
          <Border>
            <Style>None</Style>
          </Border>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
        </Style>
      </Textbox>
      <Textbox Name="Company">
        <CanGrow>true</CanGrow>
        <CanShrink>true</CanShrink>
        <KeepTogether>true</KeepTogether>
        <Paragraphs>
          <Paragraph>
            <TextRuns>
              <TextRun>
                <Value>=First(Fields!comp_PRCorrTradestyle.Value, "dsHeader")</Value>
                <Style>
                  <FontSize>12pt</FontSize>
                </Style>
              </TextRun>
            </TextRuns>
            <Style>
              <TextAlign>Center</TextAlign>
            </Style>
          </Paragraph>
        </Paragraphs>
        <Top>0.46875in</Top>
        <Height>0.25in</Height>
        <Width>7.5875in</Width>
        <ZIndex>3</ZIndex>
        <Style>
          <Border>
            <Style>None</Style>
          </Border>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
        </Style>
      </Textbox>
      <Tablix Name="RatingNumerals">
        <TablixBody>
          <TablixColumns>
            <TablixColumn>
              <Width>1.10417in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>6.39583in</Width>
            </TablixColumn>
          </TablixColumns>
          <TablixRows>
            <TablixRow>
              <Height>0.25in</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="RatingNumeral">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>=Fields!RatingNumeral.Value</Value>
                              <Style />
                            </TextRun>
                          </TextRuns>
                          <Style />
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>RatingNumeral</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>LightGrey</Color>
                          <Style>Solid</Style>
                        </Border>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="RatingNumeralDefinition">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>=Fields!RatingNumeralDefinition.Value</Value>
                              <Style />
                            </TextRun>
                          </TextRuns>
                          <Style />
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>RatingNumeralDefinition</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>LightGrey</Color>
                          <Style>Solid</Style>
                        </Border>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
          </TablixRows>
        </TablixBody>
        <TablixColumnHierarchy>
          <TablixMembers>
            <TablixMember />
            <TablixMember />
          </TablixMembers>
        </TablixColumnHierarchy>
        <TablixRowHierarchy>
          <TablixMembers>
            <TablixMember>
              <Group Name="Details" />
            </TablixMember>
          </TablixMembers>
        </TablixRowHierarchy>
        <DataSetName>dsRatingNumerals</DataSetName>
        <Top>2.22792in</Top>
        <Left>0.025in</Left>
        <Height>0.25in</Height>
        <Width>7.5in</Width>
        <ZIndex>4</ZIndex>
        <Style>
          <Border>
            <Style>None</Style>
          </Border>
        </Style>
      </Tablix>
    </ReportItems>
    <Height>2.54861in</Height>
    <Style />
  </Body>
  <Width>7.5875in</Width>
  <Page>
    <PageHeader>
      <Height>0.25in</Height>
      <PrintOnLastPage>true</PrintOnLastPage>
      <Style />
    </PageHeader>
    <PageFooter>
      <Height>0.25in</Height>
      <PrintOnFirstPage>true</PrintOnFirstPage>
      <PrintOnLastPage>true</PrintOnLastPage>
      <Style />
    </PageFooter>
    <LeftMargin>0.5in</LeftMargin>
    <RightMargin>0.3in</RightMargin>
    <TopMargin>0.5in</TopMargin>
    <BottomMargin>0.5in</BottomMargin>
    <Style />
  </Page>
  <AutoRefresh>0</AutoRefresh>
  <DataSources>
    <DataSource Name="BBS">
      <DataSourceReference>BBS</DataSourceReference>
      <rd:SecurityType>None</rd:SecurityType>
      <rd:DataSourceID>5d6b3e9f-9fe7-49d1-b74a-da111d17163c</rd:DataSourceID>
    </DataSource>
  </DataSources>
  <DataSets>
    <DataSet Name="dsMonitoredCompany">
      <Query>
        <DataSourceName>BBS</DataSourceName>
        <QueryParameters>
          <QueryParameter Name="@PersonID">
            <Value>=Parameters!PersonID.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@CompanyID">
            <Value>=Parameters!CompanyID.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@StartDate">
            <Value>=Parameters!StartDate.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@EndDate">
            <Value>=Parameters!EndDate.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@AccessLevelThreshold">
            <Value>=Parameters!AccessLevelThreshold.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@MonitoredCompanyID">
            <Value>=Parameters!MonitoredCompanyID.Value</Value>
          </QueryParameter>
        </QueryParameters>
        <CommandText>DECLARE @ChangePreference varchar(40)

SELECT @ChangePreference = ISNULL(peli_PRAUSChangePreference,1)
  FROM Person_Link WITH (NOLOCK)
 WHERE peli_PersonID = @PersonID
   AND peli_CompanyID = @CompanyID
   AND peli_PRStatus In ('1', '2');

SELECT DISTINCT MonitoredCompanyID, comp_PRCorrTradestyle, CityStateCountryShort
  FROM (
    SELECT DISTINCT prwuld_AssociatedID As MonitoredCompanyID
    FROM PRWebUserListDetail WITH (NOLOCK)
    INNER JOIN PRCreditSheet WITH (NOLOCK) on prwuld_AssociatedID = prcs_CompanyID
    INNER JOIN PRWebUserList WITH (NOLOCK) on prwuld_WebUserListID = prwucl_WebUserListID
    INNER JOIN PRWebUser WITH (NOLOCK) on prwucl_WebUserID = prwu_WebUserID
    INNER JOIN Person_Link WITH (NOLOCK) on prwu_PersonLinkID = peli_PersonLinkID
    WHERE prcs_PublishableDate BETWEEN @StartDate AND @EndDate
           AND prcs_Status = 'P' -- Publishable
           AND prcs_NewListing IS NULL
           AND ISNULL(prcs_KeyFlag, 'N') = CASE WHEN @ChangePreference ='1' THEN 'Y' ELSE ISNULL(prcs_KeyFlag, 'N')  END
           AND peli_PersonID = @PersonID
           AND peli_CompanyID = @CompanyID
           AND peli_PRStatus In ('1', '2')
           AND CAST(prwu_AccessLevel AS int) &gt;= @AccessLevelThreshold
           AND prwucl_TypeCode = 'AUS' 
           AND prwuld_AssociatedType = 'C'
           AND prwuld_AssociatedID = CASE WHEN @MonitoredCompanyID IS NULL THEN prwuld_AssociatedID ELSE @MonitoredCompanyID END
    UNION
        SELECT DISTINCT prbr_RequestedCompanyID As MonitoredCompanyID
        FROM PRWebUserList WITH (NOLOCK)
        INNER JOIN PRWebUser WITH (NOLOCK) on prwucl_WebUserID = prwu_WebUserID    
        INNER JOIN Person_Link WITH (NOLOCK) on prwu_PersonLinkID = peli_PersonLinkID 
        INNER JOIN PRBusinessReportRequest WITH (NOLOCK) ON peli_PersonID = prbr_RequestingPersonID and peli_CompanyID = prbr_RequestingCompanyID 
        INNER JOIN PRCreditSheet WITH (NOLOCK) on prbr_RequestedCompanyID = prcs_CompanyID			   
        WHERE prcs_PublishableDate BETWEEN @StartDate AND @EndDate
           AND prcs_Status = 'P' -- Publishable
           AND prcs_NewListing IS NULL
           AND ISNULL(prcs_KeyFlag, 'N') = CASE WHEN @ChangePreference ='1' THEN 'Y' ELSE ISNULL(prcs_KeyFlag, 'N')  END
           AND prbr_CreatedDate &gt; DATEADD(month, -6, GETDATE())
           AND peli_PersonID = @PersonID
           AND peli_CompanyID = @CompanyID 
           AND peli_PRStatus In ('1', '2')
           AND CAST(prwu_AccessLevel AS int) &gt;= @AccessLevelThreshold
           AND prwucl_TypeCode = 'AUS'
           AND prbr_RequestedCompanyID = CASE WHEN @MonitoredCompanyID IS  NULL THEN prbr_RequestedCompanyID ELSE @MonitoredCompanyID END
  UNION      
        SELECT DISTINCT prpbarc_CompanyID As MonitoredCompanyID
          FROM PRWebUserList WITH (NOLOCK)
               INNER JOIN PRWebUserListDetail WITH (NOLOCK) on prwucl_WebUserListID = prwuld_WebUserListID
               INNER JOIN PRWebUser WITH (NOLOCK) on prwucl_WebUserID = prwu_WebUserID
               INNER JOIN PRPublicationArticleCompany WITH (NOLOCK) on prwuld_AssociatedID = prpbarc_CompanyID
               INNER JOIN PRPublicationArticle WITH (NOLOCK) ON prpbarc_PublicationArticleID = prpbar_PublicationArticleID
               INNER JOIN Person_Link WITH (NOLOCK) on prwu_PersonLinkID = peli_PersonLinkID
         WHERE prwucl_TypeCode = 'AUS'
           AND CAST(ISNULL(prwu_AccessLevel, 0) as Integer) &gt;= @AccessLevelThreshold
           AND prpbarc_CompanyID = CASE WHEN @MonitoredCompanyID IS NULL THEN prpbarc_CompanyID ELSE @MonitoredCompanyID END
           AND prpbar_PublishDate BETWEEN @StartDate AND @EndDate
           AND prpbar_News = 'Y'
           AND peli_PRStatus = '1'
           AND peli_PRAUSChangePreference = '2'
           AND peli_PRAUSReceiveMethod IN (1,2)
           AND peli_PersonID = @PersonID
           AND peli_CompanyID = @CompanyID

   UNION

		SELECT DISTINCT prss_RespondentCompanyId As MonitoredCompanyID
          FROM PRWebUserList WITH (NOLOCK)
               INNER JOIN PRWebUserListDetail WITH (NOLOCK) on prwucl_WebUserListID = prwuld_WebUserListID
               INNER JOIN PRWebUser WITH (NOLOCK) on prwucl_WebUserID = prwu_WebUserID
               INNER JOIN PRSSFile WITH (NOLOCK) on prwuld_AssociatedID = prss_RespondentCompanyId
               INNER JOIN Person_Link WITH (NOLOCK) on prwu_PersonLinkID = peli_PersonLinkID
               LEFT OUTER JOIN PRCompanyIndicators WITH (NOLOCK) ON prci2_CompanyID = peli_CompanyID
         WHERE prwucl_TypeCode = 'AUS'
           AND CAST(ISNULL(prwu_AccessLevel, 0) as Integer) &gt;= @AccessLevelThreshold
		   AND prss_RespondentCompanyId = CASE WHEN @MonitoredCompanyID IS NULL THEN prss_RespondentCompanyId ELSE @MonitoredCompanyID END
           AND prss_OpenedDate BETWEEN @StartDate AND @EndDate
           AND prss_Publish = 'Y'
           AND peli_PRStatus = '1'
           AND peli_PRAUSChangePreference = '2'
           AND peli_PRAUSReceiveMethod IN (1,2)
           AND peli_PersonID = @PersonID
           AND peli_CompanyID = @CompanyID

	UNION

		SELECT DISTINCT prcc_CompanyID As MonitoredCompanyID
          FROM PRWebUserList WITH (NOLOCK)
               INNER JOIN PRWebUserListDetail WITH (NOLOCK) on prwucl_WebUserListID = prwuld_WebUserListID
               INNER JOIN PRWebUser WITH (NOLOCK) on prwucl_WebUserID = prwu_WebUserID
               INNER JOIN PRCourtCases WITH (NOLOCK) on prwuld_AssociatedID = prcc_CompanyID
               INNER JOIN Person_Link WITH (NOLOCK) on prwu_PersonLinkID = peli_PersonLinkID
               LEFT OUTER JOIN PRCompanyIndicators WITH (NOLOCK) ON prci2_CompanyID = peli_CompanyID
         WHERE prwucl_TypeCode =  'AUS'
           AND CAST(ISNULL(prwu_AccessLevel, 0) as Integer) &gt;= @AccessLevelThreshold
		   AND prcc_CompanyID = CASE WHEN @MonitoredCompanyID IS NULL THEN prcc_CompanyID ELSE @MonitoredCompanyID END
           AND prcc_CreatedDate BETWEEN @StartDate AND @EndDate
		   AND prcc_FiledDate &gt; DATEADD(day, -45, GETDATE())
           AND peli_PRStatus = '1'
           AND peli_PRAUSChangePreference = '2'
           AND peli_PRAUSReceiveMethod IN (1,2)
           AND peli_PersonID = @PersonID
           AND peli_CompanyID = @CompanyID

        ) T1
        INNER JOIN Company WITH (NOLOCK) ON MonitoredCompanyID = comp_CompanyID
        INNER JOIN vPRLocation on comp_PRListingCityID = prci_CityID
ORDER BY MonitoredCompanyID;</CommandText>
        <rd:UseGenericDesigner>true</rd:UseGenericDesigner>
      </Query>
      <Fields>
        <Field Name="MonitoredCompanyID">
          <DataField>MonitoredCompanyID</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="comp_PRCorrTradestyle">
          <DataField>comp_PRCorrTradestyle</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="CityStateCountryShort">
          <DataField>CityStateCountryShort</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="dsDefaultDate">
      <Query>
        <DataSourceName>BBS</DataSourceName>
        <CommandText>SELECT CAST(capt_code AS DateTime) AS StartDate,
             GETDATE() AS EndDate
  FROM Custom_Captions 
WHERE capt_family = 'prau_LastRunDate'</CommandText>
        <rd:UseGenericDesigner>true</rd:UseGenericDesigner>
      </Query>
      <Fields>
        <Field Name="StartDate">
          <DataField>StartDate</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="EndDate">
          <DataField>EndDate</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="dsHeader">
      <Query>
        <DataSourceName>BBS</DataSourceName>
        <QueryParameters>
          <QueryParameter Name="@PersonID">
            <Value>=Parameters!PersonID.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@CompanyID">
            <Value>=Parameters!CompanyID.Value</Value>
          </QueryParameter>
        </QueryParameters>
        <CommandText>SELECT dbo.ufn_FormatPerson(pers_FirstName, pers_LastName, pers_MiddleName, pers_PRNickName1, pers_Suffix) As FullName, 
       comp_PRCorrTradestyle, 
	   peli_PRAUSReceiveMethod, 
	   ISNULL(peli_PRAUSChangePreference,1) AS peli_PRAUSChangePreference,
	   CASE comp_PRIndustryType WHEN 'L' THEN 'https://apps.bluebookservices.com/BBOS/GetPublicationFile.aspx?PublicationArticleID=7732' ELSE 'https://apps.bluebookservices.com/BBOS/GetPublicationFile.aspx?PublicationArticleID=6214' END as RatingKeyURL
  FROM PRWebUser WITH (NOLOCK)
       INNER JOIN Person_Link WITH (NOLOCK) ON prwu_PersonLinkID = peli_PersonLinkID
       INNER JOIN Person WITH (NOLOCK) on peli_PersonID = pers_PersonID
       INNER JOIN Company WITH (NOLOCK) on peli_CompanyID = comp_CompanyID
 WHERE peli_PersonID = @PersonID
   AND peli_CompanyID = @CompanyID
   AND peli_PRStatus In ('1', '2');</CommandText>
        <rd:UseGenericDesigner>true</rd:UseGenericDesigner>
      </Query>
      <Fields>
        <Field Name="FullName">
          <DataField>FullName</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="comp_PRCorrTradestyle">
          <DataField>comp_PRCorrTradestyle</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="peli_PRAUSReceiveMethod">
          <DataField>peli_PRAUSReceiveMethod</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="peli_PRAUSChangePreference">
          <DataField>peli_PRAUSChangePreference</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="RatingKeyURL">
          <DataField>RatingKeyURL</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="dsRatingNumerals">
      <Query>
        <DataSourceName>BBS</DataSourceName>
        <QueryParameters>
          <QueryParameter Name="@StartDate">
            <Value>=Parameters!StartDate.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@EndDate">
            <Value>=Parameters!EndDate.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@PersonID">
            <Value>=Parameters!PersonID.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@CompanyID">
            <Value>=Parameters!CompanyID.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@AccessLevelThreshold">
            <Value>=Parameters!AccessLevelThreshold.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@MonitoredCompanyID">
            <Value>=Parameters!MonitoredCompanyID.Value</Value>
          </QueryParameter>
        </QueryParameters>
        <CommandText>DECLARE @ChangePreference varchar(40)

SELECT @ChangePreference = ISNULL(peli_PRAUSChangePreference,1)
  FROM Person_Link WITH (NOLOCK)
 WHERE peli_PersonID = @PersonID
   AND peli_CompanyID = @CompanyID
   AND peli_PRStatus In ('1', '2');

DECLARE @CreditSheetIDs table (
	prcs_CreditSheetId int
)

INSERT INTO @CreditSheetIDs
SELECT DISTINCT prcs_CreditSheetId
  FROM (SELECT DISTINCT prcs_CreditSheetId
		FROM PRWebUserListDetail WITH (NOLOCK)
		INNER JOIN PRCreditSheet WITH (NOLOCK) on prwuld_AssociatedID = prcs_CompanyID
		INNER JOIN PRWebUserList WITH (NOLOCK) on prwuld_WebUserListID = prwucl_WebUserListID
		INNER JOIN PRWebUser WITH (NOLOCK) on prwucl_WebUserID = prwu_WebUserID
		INNER JOIN Person_Link WITH (NOLOCK) on prwu_PersonLinkID = peli_PersonLinkID
         WHERE prcs_PublishableDate BETWEEN @StartDate AND @EndDate
		   AND ISNULL(prcs_KeyFlag, 'N') = CASE WHEN @ChangePreference ='1' THEN 'Y' ELSE ISNULL(prcs_KeyFlag, 'N')  END
           AND prcs_Status = 'P' -- Publishable
           AND peli_PersonID = @PersonID
           AND peli_CompanyID = @CompanyID
           AND peli_PRStatus In ('1', '2')
           AND prwu_AccessLevel &gt;= @AccessLevelThreshold
           AND prwucl_TypeCode = 'AUS' 
           AND prwuld_AssociatedType = 'C'
           AND prwuld_AssociatedID = CASE WHEN @MonitoredCompanyID IS  NULL THEN prwuld_AssociatedID ELSE @MonitoredCompanyID END
         UNION
        SELECT DISTINCT prcs_CreditSheetId
        FROM PRWebUserList WITH (NOLOCK)
                   INNER JOIN PRWebUser WITH (NOLOCK) on prwucl_WebUserID = prwu_WebUserID    
                   INNER JOIN Person_Link WITH (NOLOCK) on prwu_PersonLinkID = peli_PersonLinkID 
                   INNER JOIN PRBusinessReportRequest WITH (NOLOCK) ON peli_PersonID = prbr_RequestingPersonID and prwucl_CompanyID = prbr_RequestingCompanyID 
                   INNER JOIN PRCreditSheet WITH (NOLOCK) on prbr_RequestedCompanyID = prcs_CompanyID			   
         WHERE prcs_PublishableDate BETWEEN @StartDate AND @EndDate
           AND prcs_Status = 'P' -- Publishable
		   AND ISNULL(prcs_KeyFlag, 'N') = CASE WHEN @ChangePreference ='1' THEN 'Y' ELSE ISNULL(prcs_KeyFlag, 'N')  END
           AND prbr_CreatedDate &gt; DATEADD(month, -6, GETDATE())
           AND peli_PersonID = @PersonID
           AND peli_CompanyID = @CompanyID
           AND peli_PRStatus In ('1', '2')
           AND prwucl_TypeCode = 'AUS'
           AND prbr_RequestedCompanyID = CASE WHEN @MonitoredCompanyID IS  NULL THEN prbr_RequestedCompanyID ELSE @MonitoredCompanyID END
) T1;




DECLARE @tblWork table (
	NumeralString varchar(500)
)

INSERT INTO @tblWork
SELECT REPLACE(dbo.ufn_ExtractRatingNumerals(prcs_Numeral) +
	           dbo.ufn_ExtractRatingNumerals(prcs_Change) +
	           dbo.ufn_ExtractRatingNumerals(prcs_RatingValue) +
	           dbo.ufn_ExtractRatingNumerals(prcs_PreviousRatingValue), ',,', ',') as RatingNumerals
 FROM PRCreditSheet
WHERE prcs_CreditSheetId IN (SELECT prcs_CreditSheetId FROM @CreditSheetIDs);


DECLARE @tblWork2 table (
	Numeral varchar(5),
	NumeralInt int
)

INSERT INTO @tblWork2
SELECT value, REPLACE(REPLACE(value, '(', ''), ')', '')
  FROM @tblWork
	   CROSS APPLY dbo.Tokenize(NumeralString, ',')
	WHERE value &lt;&gt; ''
	  AND value IS NOT NULL
	  AND LEN(value) &lt;= 5;

SELECT Numeral as RatingNumeral, Description as RatingNumeralDefinition 
 FROM (
SELECT DISTINCT Numeral, NumeralInt, CAST(ISNULL(rn.capt_us, ISNULL(cn.capt_us, ISNULL(pn.capt_us, csn.capt_us))) as varchar(1000)) as Description
 FROM @tblWork2
      LEFT OUTER JOIN Custom_Captions rn ON Numeral = rn.capt_code AND rn.capt_family = 'prrn_Name'
	  LEFT OUTER JOIN Custom_Captions cn ON Numeral = cn.capt_code AND cn.capt_family = 'prcw_Name'
	  LEFT OUTER JOIN Custom_Captions pn ON Numeral = pn.capt_code AND pn.capt_family = 'prpy_Name'
	  LEFT OUTER JOIN Custom_Captions csn ON Numeral = csn.capt_code AND csn.capt_family = 'CreditSheetNumerals'
) T1
WHERE Description IS NOT NULL
ORDER BY NumeralInt

</CommandText>
        <rd:UseGenericDesigner>true</rd:UseGenericDesigner>
      </Query>
      <Fields>
        <Field Name="RatingNumeral">
          <DataField>RatingNumeral</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="RatingNumeralDefinition">
          <DataField>RatingNumeralDefinition</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
      </Fields>
    </DataSet>
    <DataSet Name="dsSpecial">
      <Query>
        <DataSourceName>BBS</DataSourceName>
        <QueryParameters>
          <QueryParameter Name="@MonitoredCompanyID">
            <Value>=Parameters!MonitoredCompanyID.Value</Value>
          </QueryParameter>
        </QueryParameters>
        <CommandText>SELECT comp_PRBookTradeStyle
  FROM Company WITH (NOLOCK)
 WHERE comp_CompanyID = ISNULL(@MonitoredCompanyID, 0)</CommandText>
        <rd:UseGenericDesigner>true</rd:UseGenericDesigner>
      </Query>
      <Fields>
        <Field Name="comp_PRBookTradeStyle">
          <DataField>comp_PRBookTradeStyle</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
      </Fields>
    </DataSet>
  </DataSets>
  <ReportParameters>
    <ReportParameter Name="PersonID">
      <DataType>Integer</DataType>
      <Prompt>Person ID</Prompt>
    </ReportParameter>
    <ReportParameter Name="CompanyID">
      <DataType>Integer</DataType>
      <Prompt>Company ID</Prompt>
    </ReportParameter>
    <ReportParameter Name="StartDate">
      <DataType>DateTime</DataType>
      <DefaultValue>
        <DataSetReference>
          <DataSetName>dsDefaultDate</DataSetName>
          <ValueField>StartDate</ValueField>
        </DataSetReference>
      </DefaultValue>
      <Prompt>Start Date</Prompt>
    </ReportParameter>
    <ReportParameter Name="EndDate">
      <DataType>DateTime</DataType>
      <DefaultValue>
        <DataSetReference>
          <DataSetName>dsDefaultDate</DataSetName>
          <ValueField>EndDate</ValueField>
        </DataSetReference>
      </DefaultValue>
      <Prompt>End Date</Prompt>
    </ReportParameter>
    <ReportParameter Name="MonitoredCompanyID">
      <DataType>Integer</DataType>
      <Nullable>true</Nullable>
      <DefaultValue>
        <Values>
          <Value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
        </Values>
      </DefaultValue>
      <AllowBlank>true</AllowBlank>
      <Prompt>Monitored Company ID</Prompt>
    </ReportParameter>
    <ReportParameter Name="AccessLevelThreshold">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>0</Value>
        </Values>
      </DefaultValue>
      <Prompt>AccessLevelThreshold</Prompt>
    </ReportParameter>
  </ReportParameters>
  <Language>en-US</Language>
  <ConsumeContainerWhitespace>true</ConsumeContainerWhitespace>
  <rd:ReportUnitType>Inch</rd:ReportUnitType>
  <rd:ReportID>e54db4f1-5b27-4410-88b1-6841a9c2ed49</rd:ReportID>
</Report>