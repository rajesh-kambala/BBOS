function createCompanyMarker(n){var i="<div class=infoWindow>"+n.display+fromAddress.replace("#lat#",n.lat).replace("#long#",n.long)+"<\/div>",t=new google.maps.Marker({position:new google.maps.LatLng(n.lat,n.long),map:map,title:n.title,icon:new google.maps.MarkerImage("https://maps.google.com/mapfiles/ms/icons/"+n.icon+".png")});google.maps.event.addListener(t,"click",function(){infowindow.setContent(i);infowindow.open(map,t);infoWindows.push(infowindow)});currentCount++;document.getElementById("currentCount").innerHTML=currentCount.toString();bounds.extend(t.position)}function closeAllInfoWindows(){for(var n=0;n<infoWindows.length;n++)infoWindows[n].close()}function setMarker(n){if(n.lat==""){var t=geoCodeCount*pause;geoCodeCount<3&&(t=100);delayGeocode(n,t)}else createCompanyMarker(n)}function geoCode(n){geocoder.geocode({address:n.address},function(t,i){if(i==google.maps.GeocoderStatus.OK){var r=t[0].geometry.location;n.lat=r.lat();n.long=r.lng();updateAddress(n);createCompanyMarker(n)}else i==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(overQueryLimit++,document.getElementById("overlimit").innerHTML=overQueryLimit.toString()):i==google.maps.GeocoderStatus.ZERO_RESULTS&&(n.lat=9999,n.long=9999,updateAddress(n),notFound++,document.getElementById("notFound").innerHTML=notFound.toString(),notFoundAddresses+=n.address+", ")})}function delayGeocode(n,t){setTimeout(function(){geoCode(n)},t)}function initialize(){var n,i,t,u,r;for(infowindow=new google.maps.InfoWindow,geocoder=new google.maps.Geocoder,bounds=new google.maps.LatLngBounds,map=new google.maps.Map(document.getElementById("map-canvas"),{zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP}),google.maps.event.addListener(map,"tilesloaded",function(){document.getElementById("pnlWait").style.display="none"}),document.getElementById("totalCompanies").innerHTML=companies.length.toString(),n=0;n<companies.length;n++)i=companies[n],i.lat==""&&geoCodeCount++,setMarker(i);t=document.createElement("div");u=new HomeControl(t,map);t.index=1;map.controls[google.maps.ControlPosition.TOP_RIGHT].push(t);r=750;geoCodeCount>0&&(r=geoCodeCount*pause+pause);setTimeout(setCenter,r);directionsService=new google.maps.DirectionsService;directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!1});directionsDisplay.setMap(map);directionsDisplay.setPanel(document.getElementById("directionsPanel"))}function setCenter(){map.fitBounds(bounds)}function updateAddress(n){PRCo.BBOS.UI.Web.AJAXHelper.SetAddressGeoCode(n.addressid,n.lat,n.long,OnSuccess,OnFailure)}function OnSuccess(){}function OnFailure(n){alert(n)}function getDir(n,t){geocoder.geocode({address:document.getElementById("clientAddress").value},function(i,r){if(r==google.maps.GeocoderStatus.OK){var u=i[0].geometry.location,f=new google.maps.LatLng(n,t),e={origin:u,destination:f,travelMode:google.maps.DirectionsTravelMode.DRIVING};directionsService.route(e,function(n,t){t==google.maps.DirectionsStatus.OK&&directionsDisplay.setDirections(n)})}else document.getElementById("clientAddress").value="Las instrucciones no se pueden calcular en este momento."})}function HomeControl(n){var t,i;n.style.padding="5px";t=document.createElement("div");t.style.backgroundColor="white";t.style.borderStyle="solid";t.style.borderWidth="1px";t.style.cursor="pointer";t.style.textAlign="center";t.title="Imprimir";t.ID="btnPrint";n.appendChild(t);i=document.createElement("div");i.style.fontFamily="Arial,sans-serif";i.style.fontSize="12px";i.style.paddingLeft="4px";i.style.paddingRight="4px";i.innerHTML="Imprimir";t.appendChild(i);google.maps.event.addDomListener(t,"click",function(){closeAllInfoWindows();window.print()})}var geocoder=null,map=null,bounds=null,infowindow=null,infoWindows=[],companies=null,directionsService,directionsDisplay,pause=1e3,geoCodeCount=0,fromAddress="<p><strong>Instrucciones para llegar aqu√≠ desde:<\/strong><br/><input id='clientAddress' type='text' style='width:280px'> <input type='button' onclick='getDir(#lat#, #long#);' value='Ir'><\/p>",currentCount=0,overQueryLimit=0,notFound=0,notFoundAddresses="";google.maps.event.addDomListener(window,"load",initialize);